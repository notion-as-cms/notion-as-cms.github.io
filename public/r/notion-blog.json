{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "notion-blog",
  "type": "registry:block",
  "title": "Notion Blog CMS",
  "description": "A complete blog system powered by Notion. Includes blog listing with pagination, individual post pages, tag filtering, table of contents, syntax highlighting, and full-featured content rendering. Built with Next.js App Router, React Server Components, and Fumadocs UI.",
  "dependencies": [
    "@notionhq/client@3.1.1",
    "notion-compat@7.3.0",
    "notion-utils@7.3.0",
    "notion-types@7.3.0",
    "react-notion-x@7.3.0",
    "fumadocs-ui@16.0.7",
    "fumadocs-core@16.0.7",
    "lucide-react@0.511.0",
    "prismjs@1.30.0",
    "@types/prismjs@1.26.5"
  ],
  "registryDependencies": [
    "button"
  ],
  "files": [
    {
      "path": "registry/default/notion-blog/components/blog-post.tsx",
      "content": "import { Renderer } from \"./renderer\";\nimport { findPageBlock } from \"@/registry/default/notion-blog/lib/notion-utils\";\nimport { getPageTableOfContents } from \"notion-utils\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport type { Tag } from \"@/registry/default/notion-blog/types/notion\";\nimport {\n  DocsPage,\n  DocsBody,\n  DocsDescription,\n  DocsTitle,\n} from \"fumadocs-ui/page\";\nimport type { ExtendedRecordMap } from \"notion-types\";\nimport { DocsLayout } from \"fumadocs-ui/layouts/docs\";\nimport { cn } from \"@/lib/utils\";\nimport { Calendar } from \"lucide-react\";\n\n// Update PageInfo type to include date\ninterface PageInfo {\n  date?: string;\n  [key: string]: any;\n}\n\ninterface TOCItemType {\n  title: React.ReactNode;\n  url: string;\n  depth: number;\n}\n\ninterface BlogPostProps {\n  recordMap: ExtendedRecordMap & {\n    pageInfo: PageInfo;\n  };\n}\n\ntype TableOfContents = TOCItemType[];\n\nexport function BlogPost({ recordMap }: BlogPostProps) {\n  const { tags = [], cover, title, description } = recordMap.pageInfo || {};\n  const safeTags = (tags as Tag[]) || [];\n\n  // Generate TOC from recordMap\n  const toc: TableOfContents = [];\n  try {\n    const pageBlock = findPageBlock(recordMap);\n    if (pageBlock) {\n      const items = getPageTableOfContents(pageBlock, recordMap);\n      items.forEach((item) => {\n        if (item?.id && item?.text) {\n          toc.push({\n            title: item.text,\n            url: `#${item.id}`,\n            depth: item.indentLevel || 0,\n          });\n        }\n      });\n    }\n  } catch (error) {\n    console.error(\"Error generating TOC:\", error);\n  }\n\n  return (\n    <>\n      <div className=\"relative container px-4 py-8 lg:py-12 lg:px-6 text-left\">\n        {/* Cover Image */}\n        {cover && (\n          <div className=\"relative w-full h-64 md:h-96 mb-8 rounded-lg overflow-hidden\">\n            <Image\n              src={cover}\n              alt=\"Post cover\"\n              fill\n              className=\"object-cover\"\n              priority\n              sizes=\"(max-width: 768px) 100vw, 75vw\"\n            />\n          </div>\n        )}\n\n        <div className=\"mb-4 text-gray-600 dark:text-gray-400 text-sm font-medium\">\n          <div className=\"flex flex-wrap gap-3\">\n            <span className=\"inline-flex items-center gap-1.5\">\n              <Calendar className=\"h-4 w-4\" />\n              {new Date(\n                recordMap.block[Object.keys(recordMap.block)[0]]?.value\n                  ?.last_edited_time || \"\"\n              ).toLocaleDateString(\"en-US\", {\n                year: \"numeric\",\n                month: \"long\",\n                day: \"numeric\",\n              })}\n            </span>\n          </div>\n        </div>\n\n        <DocsTitle className=\"text-left dark:text-white\">\n          {title || \"Untitled\"}\n        </DocsTitle>\n\n        {description && (\n          <DocsDescription className=\"text-left mt-3 dark:text-gray-300\">\n            {description}\n          </DocsDescription>\n        )}\n\n        {safeTags.length > 0 && (\n          <div className=\"flex flex-wrap gap-2 mt-4\">\n            {safeTags.map((tag) => (\n              <Link\n                key={tag.id}\n                href={`/blog/tag/${tag.value}`}\n                className=\"px-2.5 py-0.5 bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-300 rounded-full text-xs font-medium\"\n              >\n                {tag.label}\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <DocsLayout\n        nav={{ enabled: false }}\n        tree={{\n          name: \"Blog\",\n          children: [],\n        }}\n        sidebar={{ enabled: false, prefetch: false, tabs: false }}\n      >\n        <DocsPage\n          full={false}\n          footer={{ enabled: false }}\n          tableOfContent={{\n            single: false,\n          }}\n          container={{\n            className: cn(\n              \"bg-zinc-50/50 dark:bg-zinc-900/50 !container px-4 lg:px-6\"\n            ),\n          }}\n        >\n          <DocsBody>\n            <div\n              className=\"prose dark:prose-invert max-w-none\"\n              style={\n                {\n                  \"--notion-max-width\": \"100%\",\n                } as React.CSSProperties\n              }\n            >\n              <Renderer\n                recordMap={recordMap}\n                fullPage={false}\n                darkMode={false}\n                showTableOfContents={false}\n              />\n            </div>\n          </DocsBody>\n        </DocsPage>\n      </DocsLayout>\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/blog/blog-post.tsx"
    },
    {
      "path": "registry/default/notion-blog/components/blog-list.tsx",
      "content": "import { PostList } from \"./post-list\";\nimport { mapNotionPostToBlogPost } from \"@/registry/default/notion-blog/lib/notion-mappers\";\nimport type { BlogPost, BlogListProps } from \"@/registry/default/notion-blog/types/notion\";\nimport { POSTS_PER_PAGE } from \"@/registry/default/notion-blog/lib/constants\";\n\nexport function BlogList({\n  posts,\n  tags,\n  pageParams,\n  isPaginated = false,\n  heading = \"Latest Posts\",\n  basePath = \"/blog\",\n}: BlogListProps) {\n  const currentPage = isPaginated ? getPageNumber(pageParams) : 1;\n\n  // Map all posts, filtering out any null or invalid posts\n  const allBlogPosts = posts\n    .map((post) => mapNotionPostToBlogPost(post, tags))\n    .filter((post): post is BlogPost => post !== null);\n\n  // Calculate total pages based on all valid posts\n  const totalPages = Math.ceil(allBlogPosts.length / POSTS_PER_PAGE);\n\n  // Apply pagination if enabled, otherwise show all posts\n  const displayedPosts = isPaginated\n    ? allBlogPosts.slice(\n        (currentPage - 1) * POSTS_PER_PAGE,\n        currentPage * POSTS_PER_PAGE\n      )\n    : allBlogPosts;\n\n  return (\n    <PostList\n      posts={displayedPosts}\n      currentPage={currentPage}\n      totalPages={totalPages}\n      heading={heading}\n      basePath={basePath}\n      disablePagination={!isPaginated}\n    />\n  );\n}\n\n// Helper function to get page number from params\nfunction getPageNumber(pageParams: { slug?: string[] }): number {\n  if (!pageParams.slug || pageParams.slug.length === 0) return 1;\n  const page = parseInt(pageParams.slug[pageParams.slug.length - 1], 10);\n  return isNaN(page) ? 1 : Math.max(1, page);\n}\n",
      "type": "registry:component",
      "target": "components/blog/blog-list.tsx"
    },
    {
      "path": "registry/default/notion-blog/components/post-list.tsx",
      "content": "import { ArrowRight } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Pagination } from \"@/registry/default/notion-blog/components/pagination\";\nimport type { BlogPost, PostListProps } from \"@/registry/default/notion-blog/types/notion\";\n\nexport function PostList({\n  posts,\n  currentPage,\n  totalPages,\n  heading = \"Blog Posts\",\n  description = \"Discover the latest insights and tutorials about modern web development, UI design, and component-driven architecture.\",\n  basePath = \"/blog\",\n  disablePagination = false,\n  configuration = {},\n}: PostListProps) {\n  return (\n    <div className=\"container mx-auto px-4 py-8 lg:py-12\">\n      <section className=\"mb-12 text-center\">\n        <h1 className=\"text-4xl font-bold mb-4\">{heading}</h1>\n        {description && (\n          <p className=\"text-lg text-muted-foreground max-w-3xl mx-auto\">\n            {description}\n          </p>\n        )}\n      </section>\n\n      <section className=\"space-y-12\">\n        {posts.map((post) => (\n          post ? <PostCard key={post.id} post={post} /> : null\n        ))}\n      </section>\n\n      {!disablePagination && totalPages > 1 && (\n        <div className=\"mt-12 flex justify-center\">\n          <Pagination\n            currentPage={currentPage}\n            totalPages={totalPages}\n            basePath={basePath || \"/blog\"}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction PostCard({ post }: { post: BlogPost }) {\n  const { title, description, author, date, tags = [] } = post.data;\n\n  return (\n    <article className=\"group\">\n      <div className=\"grid gap-y-6 sm:grid-cols-10 sm:gap-x-5 sm:gap-y-0 md:items-center md:gap-x-8 lg:gap-x-12\">\n        <div className=\"sm:col-span-5\">\n          <div className=\"mb-4 md:mb-6\">\n            <div className=\"flex flex-wrap gap-3 text-xs uppercase tracking-wider text-muted-foreground md:gap-5 lg:gap-6\">\n              {tags.map((tag) => (\n                <span key={tag}>{tag}</span>\n              ))}\n            </div>\n          </div>\n          <h3 className=\"text-xl font-semibold md:text-2xl lg:text-3xl text-left\">\n            <Link href={post.url} className=\"hover:underline cursor-pointer\">\n              {title}\n            </Link>\n          </h3>\n          <p className=\"mt-4 text-muted-foreground md:mt-5 text-left\">\n            {description}\n          </p>\n          <div className=\"mt-6 flex items-center space-x-4 text-sm md:mt-8\">\n            <span className=\"text-muted-foreground capitalize\">\n              {author || \"Anonymous\"}\n            </span>\n            <span className=\"text-muted-foreground\">•</span>\n            <span className=\"text-muted-foreground\">\n              {new Date(date).toDateString()}\n            </span>\n          </div>\n          <div className=\"mt-6 flex items-center space-x-2 md:mt-8\">\n            <Link\n              href={post.url}\n              className=\"inline-flex items-center font-semibold hover:underline md:text-base\"\n            >\n              <span>Read more</span>\n              <ArrowRight className=\"ml-2 size-4 transition-transform\" />\n            </Link>\n          </div>\n        </div>\n        <div className=\"order-first sm:order-last sm:col-span-5\">\n          <Link href={post.url} className=\"block\">\n            <div className=\"aspect-[16/9] overflow-clip rounded-lg border border-border\">\n              <img\n                src={`https://picsum.photos/400/225?grayscale&title=${title}`}\n                alt={title}\n                className=\"h-full w-full object-cover transition-opacity duration-200 fade-in hover:opacity-70\"\n              />\n            </div>\n          </Link>\n        </div>\n      </div>\n    </article>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/blog/post-list.tsx"
    },
    {
      "path": "registry/default/notion-blog/components/pagination.tsx",
      "content": "import Link from \"next/link\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport type { PaginationProps } from \"@/registry/default/notion-blog/types/notion\";\n\nexport function Pagination({\n  currentPage,\n  totalPages,\n  basePath = \"/blog\",\n}: PaginationProps) {\n  // Ensure currentPage is within valid range\n  const safeCurrentPage = Math.max(1, Math.min(currentPage, totalPages));\n  const pageIndex = safeCurrentPage - 1;\n\n  // Don't render if there's only one page or no pages\n  if (totalPages <= 1) {\n    return null;\n  }\n\n  // Generate proper href for the previous page\n  const getPreviousHref = () => {\n    if (pageIndex <= 1) return basePath;\n    return `${basePath}/page/${pageIndex}`;\n  };\n\n  // Generate proper href for the next page\n  const getNextHref = () => {\n    return `${basePath}/page/${safeCurrentPage + 1}`;\n  };\n\n  return (\n    <nav\n      className=\"flex justify-center mt-8 space-x-4\"\n      aria-label=\"Pagination\"\n    >\n      <div className=\"flex items-center gap-4\">\n        {/* Previous Page Button */}\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          asChild={pageIndex > 0}\n          disabled={pageIndex === 0}\n          aria-disabled={pageIndex === 0 ? \"true\" : undefined}\n          className=\"min-w-[7rem]\"\n        >\n          {pageIndex > 0 ? (\n            <Link\n              href={getPreviousHref()}\n              prefetch={false}\n              className=\"flex items-center justify-center\"\n              aria-label=\"Previous page\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-1\" />\n              Previous\n            </Link>\n          ) : (\n            <span className=\"flex items-center\">\n              <ChevronLeft className=\"h-4 w-4 mr-1\" />\n              Previous\n            </span>\n          )}\n        </Button>\n\n        {/* Page Indicator */}\n        <div\n          className=\"text-sm text-muted-foreground px-4 py-2 bg-muted rounded-md\"\n          aria-current=\"page\"\n        >\n          Page {safeCurrentPage} of {totalPages}\n        </div>\n\n        {/* Next Page Button */}\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          asChild={pageIndex + 1 < totalPages}\n          disabled={pageIndex + 1 >= totalPages}\n          aria-disabled={pageIndex + 1 >= totalPages ? \"true\" : undefined}\n          className=\"min-w-[7rem]\"\n        >\n          {pageIndex + 1 < totalPages ? (\n            <Link\n              href={getNextHref()}\n              prefetch={false}\n              className=\"flex items-center justify-center\"\n              aria-label=\"Next page\"\n            >\n              Next\n              <ChevronRight className=\"h-4 w-4 ml-1\" />\n            </Link>\n          ) : (\n            <span className=\"flex items-center\">\n              Next\n              <ChevronRight className=\"h-4 w-4 ml-1\" />\n            </span>\n          )}\n        </Button>\n      </div>\n    </nav>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/blog/pagination.tsx"
    },
    {
      "path": "registry/default/notion-blog/components/renderer.tsx",
      "content": "\"use client\";\nimport { NotionRenderer } from \"react-notion-x\";\nimport type { ComponentProps } from \"react\";\nimport Link from \"next/link\";\nimport dynamic from \"next/dynamic\";\n\nconst Code = dynamic(() =>\n  import(\"react-notion-x/build/third-party/code\").then(async (m) => {\n    // additional prism syntaxes\n    await Promise.all([\n      import(\"prismjs/components/prism-markup-templating.js\"),\n      import(\"prismjs/components/prism-markup.js\"),\n      import(\"prismjs/components/prism-bash.js\"),\n      import(\"prismjs/components/prism-c.js\"),\n      import(\"prismjs/components/prism-cpp.js\"),\n      import(\"prismjs/components/prism-csharp.js\"),\n      import(\"prismjs/components/prism-docker.js\"),\n      import(\"prismjs/components/prism-java.js\"),\n      import(\"prismjs/components/prism-js-templates.js\"),\n      import(\"prismjs/components/prism-coffeescript.js\"),\n      import(\"prismjs/components/prism-diff.js\"),\n      import(\"prismjs/components/prism-git.js\"),\n      import(\"prismjs/components/prism-go.js\"),\n      import(\"prismjs/components/prism-graphql.js\"),\n      import(\"prismjs/components/prism-handlebars.js\"),\n      import(\"prismjs/components/prism-less.js\"),\n      import(\"prismjs/components/prism-makefile.js\"),\n      import(\"prismjs/components/prism-markdown.js\"),\n      import(\"prismjs/components/prism-objectivec.js\"),\n      import(\"prismjs/components/prism-ocaml.js\"),\n      import(\"prismjs/components/prism-python.js\"),\n      import(\"prismjs/components/prism-reason.js\"),\n      import(\"prismjs/components/prism-rust.js\"),\n      import(\"prismjs/components/prism-sass.js\"),\n      import(\"prismjs/components/prism-scss.js\"),\n      import(\"prismjs/components/prism-solidity.js\"),\n      import(\"prismjs/components/prism-sql.js\"),\n      import(\"prismjs/components/prism-stylus.js\"),\n      import(\"prismjs/components/prism-swift.js\"),\n      import(\"prismjs/components/prism-wasm.js\"),\n      import(\"prismjs/components/prism-yaml.js\"),\n    ]);\n    return m.Code;\n  })\n);\n\nexport function Renderer(props: ComponentProps<typeof NotionRenderer>) {\n  return (\n    <NotionRenderer\n      {...props}\n      components={{\n        nextLink: Link,\n        Code,\n      }}\n      previewImages={false}\n    />\n  );\n}\n",
      "type": "registry:component",
      "target": "components/blog/renderer.tsx"
    },
    {
      "path": "registry/default/notion-blog/lib/notion.ts",
      "content": "// lib/notion.ts\nimport { Client } from \"@notionhq/client\";\nimport { NotionCompatAPI } from \"notion-compat\";\nimport {\n  PageObjectResponse,\n  RichTextItemResponse,\n} from \"@notionhq/client/build/src/api-endpoints\";\nimport type { PageInfo, Tag } from \"@/types/notion\";\n\nexport const notion = new Client({ auth: process.env.NOTION_API_KEY });\n\nexport const notionCustom = new NotionCompatAPI(notion);\n\nexport const getPage = async (pageId: string, allTags?: Tag[]) => {\n  const recordMap = await notionCustom.getPage(pageId);\n  const rawPage = (recordMap as any).raw?.page;\n  const properties = rawPage?.properties || {};\n\n  console.log(\"rawPage\", rawPage);\n\n  // Extract common page properties\n  const pageInfo: PageInfo = {\n    id: rawPage?.id || \"\",\n    title: properties?.Name?.title?.[0]?.plain_text || \"No title\",\n    description: properties?.Description?.rich_text?.[0]?.plain_text || \"\",\n    createdAt: rawPage?.created_time || \"\",\n    lastEditedAt: rawPage?.last_edited_time || \"\",\n    cover:\n      rawPage?.cover?.type === \"external\"\n        ? rawPage.cover.external.url\n        : rawPage?.cover?.file?.url,\n    icon:\n      rawPage?.icon?.type === \"emoji\"\n        ? rawPage.icon.emoji\n        : rawPage?.icon?.file?.url || null,\n  };\n\n  // Process tags if provided\n  let blogTags: Tag[] = [];\n  if (rawPage && allTags) {\n    const tagIds = properties?.Tags?.relation?.map((r: any) => r.id) || [];\n    blogTags = allTags.filter((tag) => tagIds.includes(tag.id));\n  }\n\n  return {\n    ...recordMap,\n    pageInfo: {\n      ...pageInfo,\n      tags: blogTags, // Include tags in the page info\n      cover: pageInfo.cover, // Include cover URL\n    },\n    raw: {\n      ...(recordMap as any).raw,\n      page: rawPage,\n    },\n  } as typeof recordMap & {\n    pageInfo: PageInfo;\n    raw: {\n      page: PageObjectResponse;\n    };\n  };\n};\n\nexport async function getTags(): Promise<Tag[]> {\n  const response = await notion.databases.query({\n    database_id: process.env.NOTION_TAG_DATABASE_ID!,\n  });\n\n  return response.results.map((page: any) => ({\n    id: page.id,\n    value: page.properties.Slug.rich_text[0]?.plain_text || \"\",\n    label: page.properties.Name.title[0]?.plain_text || \"\",\n  }));\n}\n\nexport async function getPublishedPosts() {\n  return notion.databases.query({\n    database_id: process.env.NOTION_BLOG_DATABASE_ID!,\n    filter: {\n      property: \"Published\",\n      status: { equals: \"Done\" },\n    },\n  });\n}\n\nexport async function getPageBySlug(slug: string) {\n  const response = await notion.databases.query({\n    database_id: process.env.NOTION_BLOG_DATABASE_ID!,\n    filter: {\n      property: \"Slug\",\n      rich_text: { equals: slug },\n    },\n  });\n  return response.results[0];\n}\n\nexport function getPageInfo(page: PageObjectResponse): PageInfo {\n  const properties = page.properties;\n\n  // Helper to get icon URL\n  const getIconUrl = () => {\n    if (!page.icon) return null;\n\n    switch (page.icon.type) {\n      case \"emoji\":\n        return page.icon.emoji;\n      case \"external\":\n        return page.icon.external.url;\n      case \"file\":\n        return page.icon.file.url;\n      default:\n        return null;\n    }\n  };\n\n  return {\n    id: page.id,\n    title:\n      properties?.Name?.type === \"title\"\n        ? getPlainText(properties.Name.title)\n        : \"No title\",\n    description:\n      properties?.Description?.type === \"rich_text\"\n        ? getPlainText(properties.Description.rich_text)\n        : \"\",\n    createdAt: page.created_time,\n    lastEditedAt: page.last_edited_time,\n    cover:\n      page.cover?.type === \"external\"\n        ? page.cover.external.url\n        : (page.cover as any)?.file?.url, // Type assertion as cover type is complex\n    icon: getIconUrl(),\n  };\n}\n\nexport function getPlainText(rich: RichTextItemResponse[]): string {\n  return rich.map((v) => v.plain_text).join();\n}\n",
      "type": "registry:lib",
      "target": "lib/notion.ts"
    },
    {
      "path": "registry/default/notion-blog/lib/notion-mappers.ts",
      "content": "import type { BlogPost, NotionPage, Tag } from \"@/types/notion\";\n\nexport function isNotionPage(page: any): page is NotionPage {\n  return page && typeof page === \"object\" && \"properties\" in page;\n}\n\nexport function mapNotionPostToBlogPost(post: any, tags: Tag[] = []): BlogPost | null {\n  if (!isNotionPage(post)) return null;\n\n  const tagIds = post.properties.Tags?.relation?.map((r: any) => r.id) || [];\n  const postTags = tags\n    .filter(tag => tagIds.includes(tag.id))\n    .map(tag => tag.label);\n\n  const title = post.properties.Name?.title?.[0]?.plain_text || 'Untitled';\n  const description = post.properties.Description?.rich_text?.[0]?.plain_text || '';\n  const date = post.properties.Date?.date?.start || new Date().toISOString();\n  const author = post.properties.Author?.people?.[0]?.name;\n\n  // Ensure required fields are present\n  if (!title || !description || !date) {\n    console.warn(`Skipping post ${post.id} due to missing required fields`);\n    return null;\n  }\n\n  return {\n    id: post.id,\n    url: `/blog/${post.properties.Slug?.rich_text?.[0]?.plain_text || post.id}`,\n    data: {\n      title,\n      description,\n      date,\n      author,\n      tags: postTags,\n    },\n  };\n}\n",
      "type": "registry:lib",
      "target": "lib/notion-mappers.ts"
    },
    {
      "path": "registry/default/notion-blog/lib/notion-utils.ts",
      "content": "import type { Block, PageBlock, ExtendedRecordMap } from \"notion-types\";\n\nexport const isPageBlock = (block: Block): block is PageBlock => {\n  return block.type === \"page\";\n};\n\nexport const findPageBlock = (recordMap: ExtendedRecordMap): PageBlock | null => {\n  for (const blockId in recordMap.block) {\n    const block = recordMap.block[blockId]?.value;\n    if (block && isPageBlock(block)) {\n      return block;\n    }\n  }\n  return null;\n};\n",
      "type": "registry:lib",
      "target": "lib/notion-utils.ts"
    },
    {
      "path": "registry/default/notion-blog/lib/constants.ts",
      "content": "export const POSTS_PER_PAGE = 3;\n",
      "type": "registry:lib",
      "target": "lib/constants.ts"
    },
    {
      "path": "registry/default/notion-blog/lib/page-utils.ts",
      "content": "/**\n * Helper functions to determine page types based on URL parameters\n */\n\ntype PageParams = { slug?: string[] };\n\n/**\n * Checks if the current route is the blog root page\n */\nexport function isBlogRootPage(params: PageParams): boolean {\n  return !params.slug || params.slug.length === 0;\n}\n\n/**\n * Checks if the current route is a tag page\n */\nexport function isTagPage(params: PageParams): boolean {\n  return (\n    !!params.slug &&\n    params.slug.length >= 2 &&\n    params.slug[0] === \"tag\" &&\n    !!params.slug[1]\n  );\n}\n\n/**\n * Checks if the current route is a paginated tag page\n */\nexport function isPaginatedTagPage(params: PageParams): boolean {\n  return (\n    !!params.slug &&\n    params.slug.length === 4 &&\n    params.slug[0] === \"tag\" &&\n    !!params.slug[1] &&\n    params.slug[2] === \"page\" &&\n    !isNaN(Number(params.slug[3]))\n  );\n}\n\n/**\n * Checks if the current route is a blog post page\n */\nexport function isBlogPostPage(params: PageParams): boolean {\n  return !!params.slug && params.slug.length === 1 && !!params.slug[0];\n}\n\n/**\n * Checks if the current route is a paginated blog list\n */\nexport function isPaginatedBlogPage(params: PageParams): boolean {\n  return (\n    !!params.slug &&\n    params.slug.length === 2 &&\n    params.slug[0] === \"page\" &&\n    !isNaN(Number(params.slug[1]))\n  );\n}\n\n/**\n * Gets the tag slug from params if it's a tag page\n */\nexport function getTagSlug(params: PageParams): string | null {\n  if (isTagPage(params) || isPaginatedTagPage(params)) {\n    return params.slug?.[1] || null;\n  }\n  return null;\n}\n\n/**\n * Gets the page number from params if it's a paginated page\n */\nexport function getPageNumber(params: PageParams): number {\n  if (isPaginatedBlogPage(params)) {\n    return Number(params.slug?.[1]) || 1;\n  }\n  if (isPaginatedTagPage(params)) {\n    return Number(params.slug?.[3]) || 1;\n  }\n  return 1;\n}\n\n/**\n * Gets the post slug from params if it's a blog post page\n */\nexport function getPostSlug(params: PageParams): string | null {\n  if (isBlogPostPage(params)) {\n    return params.slug?.[0] || null;\n  }\n  return null;\n}\n",
      "type": "registry:lib",
      "target": "lib/page-utils.ts"
    },
    {
      "path": "registry/default/notion-blog/lib/static-params.ts",
      "content": "import { getPublishedPosts, getTags } from \"./notion\";\nimport { isNotionPage } from \"./notion-mappers\";\n\ntype StaticParam = { slug: string[] };\nconst POSTS_PER_PAGE = 3;\n\nexport async function generateBlogStaticParams() {\n  const allParams: StaticParam[] = [];\n\n  // Add root route (slug: [])\n  allParams.push({ slug: [] });\n\n  // 1. Get all published posts\n  const { results: posts } = await getPublishedPosts();\n\n  // 2. Generate root blog paths (/page/2, etc.)\n  const rootParams = generateRootPathParams(posts.length);\n  allParams.push(...rootParams);\n\n  // 3. Generate individual post paths (/{slug})\n  const postParams = generatePostPathParams(posts);\n  allParams.push(...postParams);\n\n  // 4. Generate tag paths (/tag/{tag-slug}, /tag/{tag-slug}/page/2)\n  const tagParams = await generateTagPathParams();\n  allParams.push(...tagParams);\n\n  console.log(\"allParams\", allParams);\n\n  return allParams;\n}\n\nfunction generateRootPathParams(totalPosts: number): StaticParam[] {\n  const totalPages = Math.ceil(totalPosts / POSTS_PER_PAGE);\n  const params: StaticParam[] = [];\n\n  // Skip page 1 as it's handled by the root route\n  for (let i = 1; i < totalPages; i++) {\n    params.push({ slug: [\"page\", (i + 1).toString()] });\n  }\n\n  return params;\n}\n\nfunction generatePostPathParams(posts: any[]): StaticParam[] {\n  return posts\n    .filter((post) => \"properties\" in post)\n    .filter((post) => {\n      const slugProp = post.properties.Slug;\n      return (\n        slugProp?.type === \"rich_text\" &&\n        Array.isArray(slugProp.rich_text) &&\n        slugProp.rich_text.length > 0\n      );\n    })\n    .map((post) => ({\n      slug: [post.properties.Slug.rich_text[0].plain_text],\n    }));\n}\n\nasync function generateTagPathParams(): Promise<StaticParam[]> {\n  const [tags, { results: posts }] = await Promise.all([\n    getTags(),\n    getPublishedPosts(),\n  ]);\n\n  console.log(\"tags\", tags);\n\n  const allParams: StaticParam[] = [];\n  const tagPostCounts = new Map<string, number>();\n\n  // Count posts per tag\n  for (const post of posts) {\n    if (isNotionPage(post)) {\n      const tagsProperty = post.properties.Tags;\n      if (tagsProperty) {\n        const tagIds = tagsProperty.relation?.map((r) => r.id) || [];\n        console.log(`Post ${post.id} has tags:`, tagIds);\n        tagIds.forEach((tagId: string) => {\n          tagPostCounts.set(tagId, (tagPostCounts.get(tagId) || 0) + 1);\n        });\n      }\n    }\n  }\n\n  // Debug: Log the post count for each tag\n  console.log(\"Tag post counts:\");\n  tags.forEach((tag) => {\n    console.log(\n      `- ${tag.label} (${tag.id}): ${tagPostCounts.get(tag.id) || 0} posts`\n    );\n  });\n\n  // Generate paths for each tag\n  for (const tag of tags) {\n    const postCount = tagPostCounts.get(tag.id) || 0;\n\n    if (postCount === 0) continue;\n\n    // Add tag page (/blog/tag/{tag-slug})\n    allParams.push({ slug: [\"tag\", tag.value] });\n\n    // Add pagination pages if needed (/blog/tag/{tag-slug}/page/2, etc.)\n    const totalPages = Math.ceil(postCount / POSTS_PER_PAGE);\n    for (let i = 1; i < totalPages; i++) {\n      allParams.push({\n        slug: [\"tag\", tag.value, \"page\", (i + 1).toString()],\n      });\n    }\n  }\n\n  return allParams;\n}\n",
      "type": "registry:lib",
      "target": "lib/static-params.ts"
    },
    {
      "path": "registry/default/notion-blog/types/notion.ts",
      "content": "import type { ExtendedRecordMap, PageBlock } from \"notion-types\";\nimport type { PageObjectResponse, DatabaseObjectResponse } from \"@notionhq/client/build/src/api-endpoints\";\n\ntype NotionResponse = PageObjectResponse | DatabaseObjectResponse;\n\nexport interface Tag {\n  id: string;\n  value: string;\n  label: string;\n}\n\nexport interface PageInfo {\n  id: string;\n  title: string;\n  description: string;\n  createdAt: string;\n  lastEditedAt: string;\n  cover?: string;\n  icon?: string | null;\n  tags?: Tag[];\n}\n\nexport type NotionPage = {\n  id: string;\n  properties: {\n    Name?: {\n      title: Array<{ plain_text: string }>;\n    };\n    Description?: {\n      rich_text: Array<{ plain_text: string }>;\n    };\n    Slug?: {\n      rich_text: Array<{ plain_text: string }>;\n    };\n    Date?: {\n      date: { start: string };\n    };\n    Author?: {\n      people: Array<{ name: string }>;\n    };\n    Tags?: {\n      relation: Array<{ id: string }>;\n    };\n    [key: string]: any;\n  };\n} & (\n  | { object: 'page' }\n  | { object: 'database' }\n  | { object: 'block' }\n);\n\nexport interface NotionPageWithInfo extends ExtendedRecordMap {\n  pageInfo: PageInfo;\n  raw: {\n    page: PageObjectResponse;\n  };\n}\n\nexport interface BlogPost {\n  id: string;\n  url: string;\n  data: {\n    title: string;\n    description: string;\n    date: string;\n    author: string | undefined;\n    tags: string[];\n  };\n}\n\nexport interface BlogConfiguration {\n  pageSize?: number;\n  basePath?: string;\n}\n\nexport interface BlogListProps {\n  posts: NotionPage[];\n  tags: Tag[];\n  pageParams: { slug?: string[] };\n  isPaginated: boolean;\n  heading?: string;\n  basePath?: string;\n}\n\nexport interface BlogPostProps {\n  recordMap: NotionPageWithInfo;\n}\n\nexport interface PaginationProps {\n  currentPage: number;\n  totalPages: number;\n  basePath?: string;\n}\n\nexport interface PostListProps {\n  posts: BlogPost[];\n  currentPage: number;\n  totalPages: number;\n  heading?: string;\n  description?: string;\n  basePath?: string;\n  disablePagination?: boolean;\n  configuration?: BlogConfiguration;\n}\n\nexport interface TableOfContentsProps {\n  pageBlock: PageBlock | null;\n  recordMap: ExtendedRecordMap;\n}\n",
      "type": "registry:lib",
      "target": "types/notion.ts"
    },
    {
      "path": "registry/default/notion-blog/app/blog/[[...slug]]/page.tsx",
      "content": "import {\n  getPage,\n  getPageBySlug,\n  getPublishedPosts,\n  getTags,\n} from \"@/lib/notion\";\nimport { BlogList } from \"@/components/blog/BlogList\";\nimport { BlogPost } from \"@/components/blog/BlogPost\";\nimport { notFound } from \"next/navigation\";\nimport { generateBlogStaticParams } from \"@/lib/static-params\";\nimport { POSTS_PER_PAGE } from \"@/lib/constants\";\nimport type { NotionPage } from \"@/types/notion\";\nimport {\n  isBlogRootPage,\n  isBlogPostPage,\n  isTagPage,\n  isPaginatedTagPage,\n  isPaginatedBlogPage,\n  getTagSlug,\n  getPageNumber,\n  getPostSlug,\n} from \"@/lib/page-utils\";\n\nexport { generateBlogStaticParams as generateStaticParams };\n\n// Main page component\nexport default async function Page(props: {\n  params: Promise<{ slug?: string[] }>;\n}) {\n  const params = await props.params;\n  const { slug = [] } = params;\n  const postsResponse = await getPublishedPosts();\n  const posts = (\n    Array.isArray(postsResponse) ? postsResponse : postsResponse.results || []\n  ) as NotionPage[];\n  const tags = await getTags();\n  const pageParams = { slug };\n\n  // Handle blog post page\n  if (isBlogPostPage(pageParams)) {\n    const postSlug = getPostSlug(pageParams);\n    if (!postSlug) {\n      return <div className=\"max-w-3xl mx-auto p-4\">Invalid post URL</div>;\n    }\n\n    const post = await getPageBySlug(postSlug);\n    if (!post) {\n      return <div className=\"max-w-3xl mx-auto p-4\">Post not found</div>;\n    }\n    const recordMap = await getPage(post.id, tags);\n    return <BlogPost recordMap={recordMap} />;\n  }\n\n  // Handle tag pages (both paginated and non-paginated)\n  if (isTagPage(pageParams) || isPaginatedTagPage(pageParams)) {\n    const tagSlug = getTagSlug(pageParams);\n    if (!tagSlug) {\n      return <div className=\"max-w-3xl mx-auto p-4\">Invalid tag URL</div>;\n    }\n\n    const tag = tags.find((t) => t.value === tagSlug);\n    if (!tag) {\n      return <div className=\"max-w-3xl mx-auto p-4\">Tag not found</div>;\n    }\n\n    const taggedPosts = posts.filter((post) => {\n      const postTags = post.properties?.Tags?.relation || [];\n      return postTags.some((t: { id: string }) => t.id === tag.id);\n    });\n\n    return (\n      <BlogList\n        posts={taggedPosts}\n        tags={tags}\n        pageParams={pageParams}\n        isPaginated={true}\n        heading={`Posts tagged with: ${tag.label}`}\n        basePath={`/blog/tag/${tag.value}`}\n      />\n    );\n  }\n\n  // Handle blog root and paginated blog pages\n  if (isBlogRootPage(pageParams) || isPaginatedBlogPage(pageParams)) {\n    return (\n      <BlogList\n        posts={posts}\n        tags={tags}\n        pageParams={pageParams}\n        isPaginated={true}\n        heading=\"Latest Posts\"\n        basePath=\"/blog\"\n      />\n    );\n  }\n\n  // 404 - Not Found\n  return (\n    <div className=\"max-w-3xl mx-auto p-4\">\n      <h1 className=\"text-3xl font-bold mb-4\">404 - Page Not Found</h1>\n      <p className=\"text-gray-600\">The requested page could not be found.</p>\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/blog/[[...slug]]/page.tsx"
    },
    {
      "path": "registry/default/notion-blog/app/blog/layout.tsx",
      "content": "import type { ReactNode } from \"react\";\n\nexport default function Layout({ children }: { children: ReactNode }) {\n  return (\n    <div className=\"flex flex-1 flex-col divide-y divide-dashed divide-border/70 border-border/70 border-dashed sm:border-b dark:divide-border dark:border-border blog\">\n      {children}\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/blog/layout.tsx"
    },
    {
      "path": ".env.example",
      "content": "# Notion API Configuration\n# Get your API key from https://www.notion.so/my-integrations\nNOTION_API_KEY=your_notion_api_key_here\n\n# Notion Blog Database ID\n# The ID of your Notion database containing blog posts\n# You can find this in the URL of your database: notion.so/.../{DATABASE_ID}?v=...\nNOTION_BLOG_DATABASE_ID=your_blog_database_id_here\n\n# Notion Tag Database ID\n# The ID of your Notion database containing tags\nNOTION_TAG_DATABASE_ID=your_tag_database_id_here\n",
      "type": "registry:file",
      "target": ".env.example"
    }
  ],
  "envVars": {
    "NOTION_API_KEY": "",
    "NOTION_BLOG_DATABASE_ID": "",
    "NOTION_TAG_DATABASE_ID": ""
  },
  "docs": "## Setup Instructions\n\n### 1. Install the Component\n\n```bash\nnpx shadcn@latest add https://notion-as-cms.github.io/r/notion-blog.json\n```\n\nThis will:\n- Install all required dependencies\n- Create components in `components/blog/`\n- Create library utilities in `lib/`\n- Create type definitions in `types/`\n- Create example app pages in `app/blog/`\n- Generate a `.env.example` file\n\n### 2. Configure Notion Integration\n\n1. **Create a Notion Integration:**\n   - Go to https://www.notion.so/my-integrations\n   - Click \"+ New integration\"\n   - Give it a name (e.g., \"My Blog\")\n   - Copy the \"Internal Integration Token\"\n\n2. **Create your databases:**\n   \n   **Blog Posts Database** with these properties:\n   - Name (title)\n   - Description (rich_text)\n   - Slug (rich_text)\n   - Date (date)\n   - Author (people)\n   - Tags (relation to Tags database)\n   - Published (status with \"Done\" option)\n   \n   **Tags Database** with these properties:\n   - Name (title)\n   - Slug (rich_text)\n\n3. **Share databases with your integration:**\n   - Open each database in Notion\n   - Click \"...\" → \"Add connections\"\n   - Select your integration\n\n4. **Get database IDs:**\n   - Open each database as a full page\n   - Copy the ID from the URL: `notion.so/{workspace}/{DATABASE_ID}?v=...`\n\n### 3. Configure Environment Variables\n\nCreate a `.env.local` file:\n\n```bash\nNOTION_API_KEY=secret_xxxxxxxxxxxxx\nNOTION_BLOG_DATABASE_ID=xxxxxxxxxxxxx\nNOTION_TAG_DATABASE_ID=xxxxxxxxxxxxx\n```\n\n### 4. Add Required Styles\n\nAdd react-notion-x styles to your global CSS:\n\n```css\n@import 'react-notion-x/src/styles.css';\n@import 'prismjs/themes/prism-tomorrow.css';\n```\n\n### 5. Usage\n\nThe catch-all route at `app/blog/[[...slug]]/page.tsx` handles:\n- `/blog` - Blog listing (paginated)\n- `/blog/page/2` - Pagination\n- `/blog/{slug}` - Individual posts\n- `/blog/tag/{tag-slug}` - Posts by tag\n- `/blog/tag/{tag-slug}/page/2` - Tag pagination\n\n### 6. Customization\n\n**Change posts per page:**\nEdit `lib/constants.ts`:\n```typescript\nexport const POSTS_PER_PAGE = 6; // Change from default 3\n```\n\n**Customize styling:**\nAll components use Tailwind CSS and are fully customizable.\n\n**Modify blog routes:**\nEdit the basePath in `app/blog/[[...slug]]/page.tsx` to change from `/blog` to another path.\n\n### 7. Build and Deploy\n\n```bash\nnpm run build\n```\n\nThe blog will be statically generated at build time using Next.js ISR."
}